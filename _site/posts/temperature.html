<!DOCTYPE HTML>
<html lang="en">

	<head>	
		<title>Temperature Data Visualization with D3.js</title>
		<meta name="author" content="Kyle Belanger" />
		<meta name="viewport" content="width=device-width">
		<!-- css -->
		<link href="/css/main.css" rel="stylesheet" type="text/css">
		<link href="/css/vendor/normalize.css" rel="stylesheet" type="text/css">
		<link href="/css/vendor/bootstrap.css" rel="stylesheet" type="text/css">
		<link href="/css/vendor/code_highlighting.css" rel="stylesheet" type="text/css">
		<!-- js libraries -->
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="https://code.jquery.com/jquery-2.2.0.js" charset="utf-8"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
		<script src="/js/vendor/bootstrap.js" charset="utf-8"></script>
	</head>	
	
	<body>
		<!-- start header -->
		<header>
			<div id="header-wrapper">
				<section class="pull-right">
					<h2><a id="home" href="/">Kyle Belanger</a></h2>
					<button type="button" class="button-icon pull-right" id="nav-display-button">
						<span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
					</button>
				</section>
			</div>
		</header>
		<!-- end header -->

		<!-- start pagewrap -->
		<div id="pagewrap">
			<div id="content">
			
			<!-- start posts -->
			<div id="posts-container">

				<section class="post">

					<h4>
						<a href="/">Index</a>
						<span>> Temperature Data Visualization with D3.js</span>
					</h4>
					<p>03 Apr 2015</p>
					<hr>

				      <section class="post-body">
				      	<p>A beautiful D3.js learning experiment - a simple interactive line graph displaying historical temperature data (30 day range) for any input location. <em>( Sigh... the free API only allows queries of 30 day intervals. )</em> </p>

<p>This first project uses some of D3&#39;s graphing functions, <code>d3.svg.axis()</code>, and <code>d3.svg.line()</code> to draw an SVG-based line graph with interactive tooltip. The historical weather data API response is parsed, formatted, and displayed as a set of <i>x</i> (date) and <i>y</i> (fahrenheit temperature) axis values.</p>

<p><hr class="dash"></p>

<table class="width-800px">
  <tr>
    <td>Location:</td>
    <td><input type="text" id="location" name="location" onkeyup="delayUpdate()" onchange="updateData()" placeholder="Baltimore, MD" required></td>     
  </tr>
  <tr>
    <td>Date:</td>      
    <td><span id="previous-date">March 15</span> - <span id="current-date">April 15</span></td>
  </tr>
</table>

<p id="location_display">Baltimore, MD, USA</p>

<div id="graph"></div>

<p><hr class="dash margin-bottom-30px"></p>

<p>The somewhat easy part was parsing the data response, and creating an array of objects. Once we have an array of data objects, it&#39;s just a matter of mapping the data to the graph.</p>

<pre class="code-block">
<code>// data variables
var lineData = [],
    day = {};

// Request and parse data
d3.json(address, function(error, data) {

    var days = data.data.weather;

    // step through each day
    days.forEach(function(d) {
        day = {date: new Date(d.date), temp: d.maxtempF};   // add data to day
        lineData.push(day);                                 // push to array
    });
});
</code>
</pre>

<p>The graph is updated asynchronously with a two-second timeout as the input value changes. This is accomplished by adding an <code>onKeyUp()</code> event listener to the form input, and setting a timeout delay to avoid requesting data with each keystroke. </p>

<pre class="code-block">
<code>// Get location input from page
var input_location = document.getElementById("location"),
    timer = null;

input_location.addEventListener('keyup', delayUpdate, false);

function delayUpdate() {

    clearTimeout(timer);
    
    timer = setTimeout(function() {
                // if more than 3 charecters entered
                if (input_location.value.length > 2) {
                    updateData();
                }
            }, 500); // .5 second delay
}</code>
</pre>

<p><hr class="dash"></p>

<table class="width-400px">
  <tr>
    <td>The full code is available on:</td>
    <td><a href="https://github.com/kylesb/static/blob/master/JS/temperature-graph/index.html">GitHub</a></td>     
  </tr>
  <tr>
    <td>Date source:</td>      
    <td><a href="http://www.worldweatheronline.com/api/docs/historical-weather-api.aspx">Historic Weather API</a></td>
  </tr>
</table>

<!-- scripts for this page -->

<script type="text/javascript" src="/js/posts/temperature/temperature.js"></script>

<!-- / scripts -->

<!-- initialize -->

<script>
    // append CSS for this page to the <head>
    var linkElement = document.createElement("link");
    linkElement.rel = "stylesheet";
    linkElement.href = "/css/posts/temperature/temperature.css";
    // append CSS file
    document.head.appendChild(linkElement);
</script>

<!-- / initialize -->

				      </section>

				</section>

			</div>
			<!-- end posts -->
			</div>
		</div>
		<!-- end pagewrap -->
	
	</body>

	<!-- initialize -->
	<script>
	    // code highlighter
	    hljs.initHighlightingOnLoad();

	    // google analytics
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-61575718-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();  
	</script>
	<!-- / initialize -->
</html>